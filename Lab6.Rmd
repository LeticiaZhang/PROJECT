---
title: "Lab6"
author: "Can Zhang"
date: "2024-10-10"
output: "github_document"
---
# Load Packages and Dataset
```{r}

library(haven)
library(dplyr)
library(ggplot2)
library(tidyr)
library(car)
load("C:/Users/User/Downloads/ICPSR_38964-V2/ICPSR_38964/DS0001/38964-0001-Data.rda")
dataset <- da38964.0001
rm(da38964.0001)

```

# Data Cleaning
```{r}

#Select variables related to my research question
my_dataset <- dataset %>% select(RELIG_ATTEND, RELIG_IMP, RACEREC, LONELY_A, LONELY_B, LONELY_C)
my_dataset <- drop_na(my_dataset)
summary(my_dataset)

#recode and composite the variables
my_dataset$RELIG_ATTEND <- 5 - as.numeric(my_dataset$RELIG_ATTEND)
my_dataset$RELIG_IMP <- 5 - as.numeric(my_dataset$RELIG_IMP)
my_dataset$RELIG_ENGAGEMENT <- (my_dataset$RELIG_ATTEND + my_dataset$RELIG_IMP) / 2

my_dataset$LONELY_A <- as.numeric(my_dataset$LONELY_A)
my_dataset$LONELY_B <- as.numeric(my_dataset$LONELY_B)
my_dataset$LONELY_C <- as.numeric(my_dataset$LONELY_C)
my_dataset$LONELY <- (my_dataset$LONELY_A + my_dataset$LONELY_B + my_dataset$LONELY_C) / 3

```

# Statistical Assumptions and Data Transformation
# Normality Assumption
```{r}

# Check skewness and kurtosis
library(moments)
skewness(my_dataset$LONELY)
kurtosis(my_dataset$LONELY)

# Bootstrap the mean for a group to see the sampling distribution
library(boot)
boot_mean <- function(data, indices) {
  d <- data[indices, ]  # Resample data with replacement
  return(mean(d$LONELY))  # Calculate mean of the 'LONELY' variable
}
my_group1 <- my_dataset[my_dataset$RACEREC == "(01) Non-Hispanic White", ]
boot_results1 <- boot(data = my_group1, statistic = boot_mean, R = 1000)
# Plot bootstrapped sampling distribution
hist(boot_results$t, main = "Bootstrapped Sampling Distribution of Mean", xlab = "Mean Loneliness")

my_group2 <- my_dataset[my_dataset$RACEREC == "(02) Non-Hispanic Black", ]
boot_results2 <- boot(data = my_group2, statistic = boot_mean, R = 1000)
hist(boot_results2$t, main = "Bootstrapped Sampling Distribution of Mean", xlab = "Mean Loneliness")

my_group3 <- my_dataset[my_dataset$RACEREC == "(03) Non-Hispanic American Indian/Alaska Native
", ]
boot_results3 <- boot(data = my_group2, statistic = boot_mean, R = 1000)
hist(boot_results3$t, main = "Bootstrapped Sampling Distribution of Mean", xlab = "Mean Loneliness")

my_group4 <- my_dataset[my_dataset$RACEREC == "(04) Hispanic", ]
boot_results4 <- boot(data = my_group4, statistic = boot_mean, R = 1000)
hist(boot_results4$t, main = "Bootstrapped Sampling Distribution of Mean", xlab = "Mean Loneliness")

my_group5 <- my_dataset[my_dataset$RACEREC == "(05) Non-Hispanic Asian or Pacific Islander", ]
boot_results5 <- boot(data = my_group5, statistic = boot_mean, R = 1000)
hist(boot_results5$t, main = "Bootstrapped Sampling Distribution of Mean", xlab = "Mean Loneliness")

```
The data distribution is generally normal, given that the skewness is not significantly deviant from 0 and kurtosis is not significantly deviant from 3. Moreover, the distribution of the sampling distribution of the mean for each group is generally normal from the histogram. Therefore, the normality assumption is generally fulfilled.

# Equal Variance Assumption
```{r}

leveneTest(LONELY ~ RACEREC, data = my_dataset)

```
The Levene's Test result is not significant, indicating that the variance is equal across groups (assumption is met).